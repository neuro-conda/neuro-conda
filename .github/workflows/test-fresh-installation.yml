name: Test Installation
run-name: ${{ github.actor }} is running tests
on: [push]
env:
  ncDebug: 1
  ncCI: 1
  ncEnv: neuro-conda-2023a
jobs:
  Test-Install:
    name: Install (${{ matrix.python-version }}, ${{ matrix.os }})
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: false
      matrix:
        os: [ "macos-latest", "windows-latest", "ubuntu-latest"]
        python-version: ["3.10"]
        include:
          - os: windows-latest
            install_script: .\libexec\install.ps1
            uninstall_script: Write-Host "Not implemented yet"
            use_shell: pwsh
          - os: macos-latest
            install_script: ./libexec/install.sh
            uninstall_script: ./libexec/uninstall.sh
            use_shell: zsh -l {0}
          - os: ubuntu-latest
            install_script: ./libexec/install.sh
            uninstall_script: ./libexec/uninstall.sh
            use_shell: bash -l {0}
    defaults:
      run:
        shell: ${{ matrix.use_shell }}
    steps:
      - uses: conda-incubator/setup-miniconda@v2
        with:
          auto-update-conda: true
          python-version: ${{ matrix.python-version }}
          mamba-version: "*"
          channels: conda-forge,defaults
      - name: Download repository
        uses: actions/checkout@v3
      - name: Run installation script ${{ matrix.install_script }} for ${{ matrix.os }}
        run: ${{ matrix.install_script }}
      - name: Activate environment ${{ env.ncEnv }} and run tests on ${{ matrix.os }}
        run: |
          source ~/.bashrc
          conda activate ${{ env.ncEnv }}
          pytest -sv
      - name: Run uninstall script ${{ matrix.uninstall_script }} for ${{ matrix.os }}
        run: ${{ matrix.uninstall_script }}
